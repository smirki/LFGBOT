"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Queue {
    constructor() {
        this.running = false;
        this.queue = [];
        this.timeout = 10 * 1000;
    }
    add(fn) {
        const promise = new Promise(resolve => {
            this.queue.push(async () => {
                await fn();
                resolve();
            });
            if (!this.running)
                this.next();
        });
        return promise;
    }
    next() {
        this.running = true;
        if (this.queue.length === 0) {
            this.running = false;
            return;
        }
        const fn = this.queue.shift();
        new Promise(resolve => {
            // Either fn() completes or the timeout is reached
            fn().then(resolve);
            setTimeout(resolve, this.timeout);
        }).then(() => this.next());
    }
}
exports.Queue = Queue;
//# sourceMappingURL=Queue.js.map